{
    "name": "Punto Legal - Sistema de Notificaciones Completo",
    "flow": [
        {
            "id": "webhook_trigger",
            "module": "webhook:webhook",
            "metadata": {
                "designer": {
                    "x": 100,
                    "y": 100
                },
                "webhook": {
                    "url": "https://hook.eu2.make.com/YOUR_WEBHOOK_ID",
                    "method": "POST",
                    "headers": {
                        "Content-Type": "application/json"
                    }
                }
            }
        },
        {
            "id": "parse_data",
            "module": "json:json",
            "metadata": {
                "designer": {
                    "x": 300,
                    "y": 100
                },
                "operation": "parse",
                "source": "{{webhook_trigger.body}}"
            }
        },
        {
            "id": "validate_data",
            "module": "filter:filter",
            "metadata": {
                "designer": {
                    "x": 500,
                    "y": 100
                },
                "conditions": [
                    {
                        "field": "{{parse_data.name}}",
                        "operator": "isNotEmpty",
                        "value": ""
                    },
                    {
                        "field": "{{parse_data.email}}",
                        "operator": "isNotEmpty",
                        "value": ""
                    },
                    {
                        "field": "{{parse_data.phone}}",
                        "operator": "isNotEmpty",
                        "value": ""
                    }
                ]
            }
        },
        {
            "id": "create_notification",
            "module": "database:database",
            "metadata": {
                "designer": {
                    "x": 700,
                    "y": 100
                },
                "operation": "insert",
                "table": "notifications",
                "data": {
                    "user_id": "{{parse_data.user_id}}",
                    "type": "consultation_request",
                    "title": "Nueva solicitud de consulta",
                    "message": "Cliente {{parse_data.name}} solicitó una consulta para {{parse_data.service}}",
                    "data": "{{parse_data}}",
                    "status": "pending",
                    "created_at": "{{now}}"
                }
            }
        },
        {
            "id": "send_email_notification",
            "module": "email:email",
            "metadata": {
                "designer": {
                    "x": 900,
                    "y": 100
                },
                "operation": "send",
                "to": "admin@puntolegal.cl",
                "subject": "Nueva solicitud de consulta - {{parse_data.name}}",
                "body": "Se ha recibido una nueva solicitud de consulta:\n\nNombre: {{parse_data.name}}\nEmail: {{parse_data.email}}\nTeléfono: {{parse_data.phone}}\nServicio: {{parse_data.service}}\nFecha: {{parse_data.date}}\nHora: {{parse_data.time}}\nMensaje: {{parse_data.message}}\n\nResponder a: {{parse_data.email}}"
            }
        },
        {
            "id": "send_confirmation_email",
            "module": "email:email",
            "metadata": {
                "designer": {
                    "x": 900,
                    "y": 300
                },
                "operation": "send",
                "to": "{{parse_data.email}}",
                "subject": "Confirmación de solicitud - Punto Legal",
                "body": "Hola {{parse_data.name}},\n\nHemos recibido tu solicitud de consulta para {{parse_data.service}}.\n\nFecha solicitada: {{parse_data.date}}\nHora: {{parse_data.time}}\n\nNos pondremos en contacto contigo pronto para confirmar los detalles.\n\nSaludos,\nEquipo Punto Legal"
            }
        },
        {
            "id": "update_notification_status",
            "module": "database:database",
            "metadata": {
                "designer": {
                    "x": 1100,
                    "y": 100
                },
                "operation": "update",
                "table": "notifications",
                "where": {
                    "id": "{{create_notification.id}}"
                },
                "data": {
                    "status": "processed",
                    "processed_at": "{{now}}"
                }
            }
        }
    ],
    "metadata": {
        "instant": false,
        "version": 1,
        "scenario": {
            "roundtrips": 1,
            "maxErrors": 3,
            "autoCommit": true,
            "autoCommitTriggerLast": true,
            "sequential": false,
            "slots": null,
            "confidential": false,
            "dataloss": false,
            "dlq": false,
            "freshVariables": false
        },
        "designer": {
            "orphans": []
        },
        "zone": "us2.make.com",
        "notes": [
            "Este escenario procesa las solicitudes de consulta del webhook",
            "1. Recibe datos del webhook",
            "2. Valida que los campos requeridos estén presentes",
            "3. Crea una notificación en la base de datos",
            "4. Envía email al administrador",
            "5. Envía email de confirmación al cliente",
            "6. Actualiza el estado de la notificación"
        ]
    }
}