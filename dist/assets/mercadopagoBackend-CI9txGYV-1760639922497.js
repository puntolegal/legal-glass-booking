import{_ as u}from"./supabase-C8gmXi9f-1760639922497.js";import"./index-91gqZ-ll-1760639922497.js";import"./vendor-BaB6ScAs-1760639922497.js";import"./router-DG5RS9oE-1760639922497.js";import"./ui-D6mNYCvq-1760639922497.js";import"./utils-C4xBKWBT-1760639922497.js";import"./animations-CHL8-JBz-1760639922497.js";const y=async o=>{try{console.log("üöÄ Creando preferencia de Checkout Pro (oficial):",o);const n=window.location.hostname==="www.puntolegal.online"||window.location.hostname==="puntolegal.online",i=n;if(n&&console.log("üö® PRODUCCI√ìN DETECTADA - Forzando uso de Supabase Function"),console.log("üîç DEBUG MercadoPago Backend:",{"import.meta.env.PROD":!1,"window.location.hostname":window.location.hostname,isProduction:n,useSupabaseFunction:i}),i)return console.log("üåê Usando funci√≥n de Supabase para producci√≥n"),await m(o);if(window.location.hostname.includes("puntolegal.online"))throw console.error("üö® ERROR CR√çTICO: Intento de usar localhost en producci√≥n"),new Error("No se puede usar backend local en producci√≥n");return console.log("üè† Usando backend local para desarrollo"),await _(o)}catch(n){throw console.error("‚ùå Error creando preferencia:",n),new Error(`Error al crear la preferencia de pago: ${n instanceof Error?n.message:"Error desconocido"}`)}},m=async o=>{var n,i,s,c,l,d;try{const r={service:((n=o.items[0])==null?void 0:n.title)||"Consulta Legal",description:((i=o.items[0])==null?void 0:i.title)||"Consulta Legal",price:((s=o.items[0])==null?void 0:s.unit_price)||0,name:o.payer.name,email:o.payer.email,phone:((c=o.payer.phone)==null?void 0:c.number)||"",date:((l=o.metadata)==null?void 0:l.appointment_date)||"",time:((d=o.metadata)==null?void 0:d.appointment_time)||"",external_reference:o.external_reference},{SUPABASE_CREDENTIALS:a}=await u(async()=>{const{SUPABASE_CREDENTIALS:p}=await import("./supabaseConfig-XHQPOxSK-1760639922497.js");return{SUPABASE_CREDENTIALS:p}},[]),t=await fetch(`${a.URL}/functions/v1/create-mercadopago-preference`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.PUBLISHABLE_KEY}`},body:JSON.stringify({paymentData:r})});if(!t.ok){const p=await t.json();throw console.error("‚ùå Error de Supabase Function:",p),new Error(`Supabase Function Error: ${p.error||"Error desconocido"}`)}const e=await t.json();if(console.log("‚úÖ Preferencia creada exitosamente:",e.preference_id),console.log("üîç Resultado completo de Supabase Function:",JSON.stringify(e,null,2)),console.log("üîó Init Point:",e.init_point),console.log("üîó Sandbox Init Point:",e.sandbox_init_point),console.log("üîç Status:",e.status),console.log("üîç Live Mode:",e.live_mode),!e.preference_id)throw console.error("‚ùå ERROR: result.preference_id no est√° presente"),new Error("ID de preferencia no recibido de Supabase Function");if(!e.init_point)throw console.error("‚ùå ERROR: result.init_point no est√° presente"),new Error("Init Point no recibido de Supabase Function");return{success:!0,preference_id:e.preference_id,init_point:e.init_point,sandbox_init_point:e.sandbox_init_point,status:e.status,live_mode:e.live_mode}}catch(r){throw console.error("‚ùå Error con Supabase Function:",r),r}},_=async o=>{var n,i,s,c,l,d;try{const r={service:((n=o.items[0])==null?void 0:n.title)||"Consulta Legal",description:((i=o.items[0])==null?void 0:i.title)||"Consulta Legal",price:((s=o.items[0])==null?void 0:s.unit_price)||0,name:o.payer.name,email:o.payer.email,phone:((c=o.payer.phone)==null?void 0:c.number)||"",date:((l=o.metadata)==null?void 0:l.appointment_date)||"",time:((d=o.metadata)==null?void 0:d.appointment_time)||"",external_reference:o.external_reference},a=await fetch("http://localhost:3001/create-preference",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentData:r})});if(!a.ok){const e=await a.json();throw console.error("‚ùå Error del backend local:",e),new Error(`Backend Error: ${e.error||"Error desconocido"}`)}const t=await a.json();return console.log("‚úÖ Preferencia creada exitosamente:",t.preference_id),console.log("üîó Init Point:",t.init_point),{success:!0,preference_id:t.preference_id,init_point:t.init_point,sandbox_init_point:t.sandbox_init_point}}catch(r){throw console.error("‚ùå Error con backend local:",r),r}};export{y as createCheckoutPreference};
